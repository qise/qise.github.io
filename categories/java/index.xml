<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Java on èµ·è‰²</title>
    <link>https://qise.github.io/categories/java/</link>
    <description>Recent content in Java on èµ·è‰²</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 08 Aug 2016 23:16:20 +0800</lastBuildDate>
    <atom:link href="https://qise.github.io/categories/java/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>utf8bm4 java mysql</title>
      <link>https://qise.github.io/utf8bm4-java-mysql/</link>
      <pubDate>Mon, 08 Aug 2016 23:16:20 +0800</pubDate>
      
      <guid>https://qise.github.io/utf8bm4-java-mysql/</guid>
      <description>

&lt;h3 id=&#34;mysqlä¸æ”¯æŒutf-8bm4çš„javaè§£å†³æ–¹æ¡ˆ:73649b4edd83d1fe0c0e3eff642a0acb&#34;&gt;Mysqlä¸æ”¯æŒUtf-8bm4çš„javaè§£å†³æ–¹æ¡ˆ&lt;/h3&gt;

&lt;p&gt;å…¬å¸çš„mysql æœåŠ¡ç«¯çš„ç‰ˆæœ¬æ˜¯5.5.2ï¼Œä½†utf8bm4æœ€ä½æ”¯æŒç‰ˆæœ¬æ˜¯5.5.3ï¼Œå¦‚æœæƒ³åœ¨æ–‡æœ¬ä¸­å­˜æ”¾emojiè¡¨æƒ…çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦åšä¸€äº›å¤„ç†&lt;/p&gt;

&lt;p&gt;ç”±äºå‡çº§msyqlæœåŠ¡ç«¯çš„åŠ¨ä½œæ¯”è¾ƒå¤§ï¼Œè¿™é‡Œè¯´çš„è§£å†³æ€è·¯æ˜¯å¦‚ä½•åœ¨ä¸å‡çº§mysqlçš„æƒ…å†µï¼Œè®©ä½ çš„åº”ç”¨å±‚å…¼å®¹utf8bm4ï¼Œå…¶å®è¿™ä¸ªæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠutf8bm4è½¬æ¢æˆmysqlèƒ½æ”¯æŒçš„å­—ç¬¦ï¼Œæˆ‘è¿™é‡Œçš„æ–¹æ¡ˆæ˜¯æŠŠutf8bm4è½¬æ¢æˆunicodeï¼ˆå› ä¸ºè½¬æˆutf8éœ€è¦8ä¸ªï¼Œunicodeåªéœ€è¦5ä¸ªï¼‰çš„å­—ç¬¦ä¸²ï¼Œç„¶åä¿å­˜å­—ç¬¦ä¸²&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š
ğŸ˜‚çš„unicodeç¼–ç æ˜¯ U+1F601ï¼Œutf8çš„ç¼–ç æ˜¯\xF0\x9F\x98\x81ï¼Œé‚£è½¬æ¢å­—ç¬¦ä¸²çš„è¯åªè¦ä¿å­˜ 1f601ï¼Œåªä¸è¿‡ä¸ºäº†å’Œæ­£å¸¸çš„å­—ç¬¦åŒºåˆ†ï¼Œå¯¹è½¬æ¢çš„unicodeè¿›è¡Œäº†ç®€é™‹çš„å¤„ç†ï¼ŒåŠ ä¸Šé¦–å°¾ç‰¹æ®Šç¬¦å· ï¼Œå¦‚[1f601]ã€‚
å½“ç„¶è¿™æ ·æ˜¯æ¯”è¾ƒç²—æš´çš„ï¼Œå¦‚æœæ­£å¸¸çš„å­—ç¬¦ä¸­ä¹Ÿæœ‰è¿™ç§å†…å®¹ï¼Œå°±è¢«å¼ºè½¬æˆäº†emojiè¡¨æƒ…ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ç†è§£ä¸ºå½©è›‹å•¦ï¼ˆè¯´ç™½äº†å°±æ˜¯ä¸šåŠ¡çš„è¦æ±‚æ¯”è¾ƒä½ï¼Œå¤„ç†çš„æ–¹å¼å¾ˆç®€é™‹ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å†æ¥çœ‹ä¸€ä¸‹è¿™ç§å¤„ç†æ–¹å¼çš„ä»£ä»·ï¼ŒåŸæœ¬ä¸€ä¸ª4å­—èŠ‚çš„emojiï¼Œç°åœ¨å˜æˆäº† [1f601]ï¼Œå‡è®¾è¿™é‡Œçš„å­—ç¬¦éƒ½æ˜¯1å­—èŠ‚çš„utf8ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦7ä¸ªå­—èŠ‚ï¼Œå¯¹å­˜å‚¨æ˜¯æœ‰ä¸€äº›æµªè´¹&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆåœ¨javaä¸­è¦æ€ä¹ˆå¤„ç†å‘¢&lt;/p&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦è¯†åˆ«ï¼Œæ–‡æœ¬æ¥æºæ˜¯å¦åŒ…å«4å­—èŠ‚ï¼ˆåªå¤„ç†äº†4å­—èŠ‚ï¼Œ4å­—èŠ‚ä»¥ä¸Šä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼æ€è·¯ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›¿æ¢&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    //æ˜¯å¦åŒ…å«4å­—èŠ‚ä»¥ä¸Šå­—ç¬¦
    public static boolean contains4BytesAbove(String src) {
        if(src == null) return false;
        try {
            byte[] bytes = src.getBytes(&amp;quot;utf-8&amp;quot;);
            for (int i = 0; i &amp;lt; bytes.length; i++) {
                byte b = bytes[i];
                if (b &amp;lt; 0 &amp;amp;&amp;amp; b &amp;gt; -17) {
                    return true;
                }
            }
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return false;
    }

    //byteæ“ä½œæœ‰ç‚¹ç²—ç³™
    public static String marshallUnicode(String src) {
        try {
            List&amp;lt;Byte&amp;gt; bytes = Bytes.asList(src.getBytes(&amp;quot;utf-8&amp;quot;));

            List&amp;lt;Integer&amp;gt; indexList = new ArrayList&amp;lt;&amp;gt;();
            List&amp;lt;String&amp;gt; unicodeList = new ArrayList&amp;lt;&amp;gt;();
            for (int i = 0; i &amp;lt; bytes.size(); i++) {
                byte b = bytes.get(i);
                String str = null;
                //ç›®å‰åªå¤„ç†äº†4å­—èŠ‚,è¶…è¿‡4å­—èŠ‚æ²¡æœ‰éªŒè¯
                if ((b &amp;amp; 0xF0) == 0xF0) {
                    indexList.add(i);
                    byte[] unicodeBytes = new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3)};
                    str = new String(unicodeBytes, &amp;quot;utf-8&amp;quot;);
                    i += 3;
                    indexList.add(i);
                } else if ((b &amp;amp; 0xF8) == 0xF8) {
                    indexList.add(i);
    //                str = new String(new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3), bytes.get(i + 4)}, &amp;quot;utf-8&amp;quot;);
                    str = &amp;quot;?&amp;quot;;
                    i += 4;
                    indexList.add(i);
                } else if ((b &amp;amp; 0xFC) == 0xFC) {
                    indexList.add(i);
    //                str = new String(new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3), bytes.get(i + 4), bytes.get(i + 5)}, &amp;quot;utf-8&amp;quot;);
                    str = &amp;quot;?&amp;quot;;
                    i += 5;
                    indexList.add(i);
                }
                if (str != null) {
                    String unicode = string2Unicode(str);
                    unicodeList.add(&amp;quot;[&amp;quot; + unicode + &amp;quot;]&amp;quot;);
                }
            }

            int begin = 0;
            List&amp;lt;Byte&amp;gt; resultBytes = Lists.newArrayList();
            for (int i = 0; i &amp;lt; unicodeList.size(); i++) {
                int start = indexList.get(2 * i), end = indexList.get(2 * i + 1);
                resultBytes.addAll(bytes.subList(begin, start));
                byte[] unicode = unicodeList.get(i).getBytes();
                resultBytes.addAll(Bytes.asList(unicode));
                begin = end + 1;
            }
            resultBytes.addAll(bytes.subList(begin, bytes.size()));

            byte[] result = Bytes.toArray(resultBytes);
            return new String(result, &amp;quot;utf-8&amp;quot;);
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return src;
    }


    //è½¬æ¢
    public static String string2Unicode(String string) {
        StringBuffer unicode = new StringBuffer();
        int length = string.length();
        int tgt = 0;
        for (int i = 0; i &amp;lt; length; i++) {
            // å–å‡ºæ¯ä¸€ä¸ªå­—ç¬¦
            char c = string.charAt(i);
            // è½¬æ¢ä¸ºunicode
            if (c &amp;lt; 56320 &amp;amp;&amp;amp; 55295 &amp;lt; c &amp;amp;&amp;amp; (i + 1) &amp;lt; length) {
                char d = string.charAt(i + 1);
                if (d &amp;lt; 57344 &amp;amp;&amp;amp; 56319 &amp;lt; d) {
                    tgt = ((c - 55296) * 1024) + (d - 56320) + 65536;
                    i++;
                }
            }
        }
        return Integer.toHexString(tgt);
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šç»“æŸäº†ï¼Œå¤„ç†å®Œè¿™ä¸ªå¯¹å­—ç¬¦ç¼–ç åˆæœ‰äº†æ›´æ·±çš„è®¤è¯†&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‚è€ƒï¼š&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://cenalulu.github.io/linux/character-encoding/&#34;&gt;http://cenalulu.github.io/linux/character-encoding/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>