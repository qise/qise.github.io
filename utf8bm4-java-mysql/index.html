	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> utf8bm4 java mysql &middot; èµ·è‰² </title>

  
  <link rel="stylesheet" href="https://qise.github.io/css/poole.css">
  <link rel="stylesheet" href="https://qise.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://qise.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="èµ·è‰²" />
</head>

	<body class="">
		<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://qise.github.io/"><h1>èµ·è‰²</h1></a>
      <p class="lead">
       æŠ€æœ¯æ”¹å˜äººç”Ÿ 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
        <li><a href="/utf8bm4-java-mysql/"> utf8bm4 java mysql </a></li>
      
    </ul>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>


		<div class="content container">
			<div class="post">
			 	<h1>utf8bm4 java mysql</h1>
			  <span class="post-date">Mon, Aug 8, 2016</span>
			      

<h3 id="mysqlä¸æ”¯æŒutf-8bm4çš„javaè§£å†³æ–¹æ¡ˆ:73649b4edd83d1fe0c0e3eff642a0acb">Mysqlä¸æ”¯æŒUtf-8bm4çš„javaè§£å†³æ–¹æ¡ˆ</h3>

<p>å…¬å¸çš„mysql æœåŠ¡ç«¯çš„ç‰ˆæœ¬æ˜¯5.5.2ï¼Œä½†utf8bm4æœ€ä½æ”¯æŒç‰ˆæœ¬æ˜¯5.5.3ï¼Œå¦‚æœæƒ³åœ¨æ–‡æœ¬ä¸­å­˜æ”¾emojiè¡¨æƒ…çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦åšä¸€äº›å¤„ç†</p>

<p>ç”±äºå‡çº§msyqlæœåŠ¡ç«¯çš„åŠ¨ä½œæ¯”è¾ƒå¤§ï¼Œè¿™é‡Œè¯´çš„è§£å†³æ€è·¯æ˜¯å¦‚ä½•åœ¨ä¸å‡çº§mysqlçš„æƒ…å†µï¼Œè®©ä½ çš„åº”ç”¨å±‚å…¼å®¹utf8bm4ï¼Œå…¶å®è¿™ä¸ªæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠutf8bm4è½¬æ¢æˆmysqlèƒ½æ”¯æŒçš„å­—ç¬¦ï¼Œæˆ‘è¿™é‡Œçš„æ–¹æ¡ˆæ˜¯æŠŠutf8bm4è½¬æ¢æˆunicodeï¼ˆå› ä¸ºè½¬æˆutf8éœ€è¦8ä¸ªï¼Œunicodeåªéœ€è¦5ä¸ªï¼‰çš„å­—ç¬¦ä¸²ï¼Œç„¶åä¿å­˜å­—ç¬¦ä¸²</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼š
ğŸ˜‚çš„unicodeç¼–ç æ˜¯ U+1F601ï¼Œutf8çš„ç¼–ç æ˜¯\xF0\x9F\x98\x81ï¼Œé‚£è½¬æ¢å­—ç¬¦ä¸²çš„è¯åªè¦ä¿å­˜ 1f601ï¼Œåªä¸è¿‡ä¸ºäº†å’Œæ­£å¸¸çš„å­—ç¬¦åŒºåˆ†ï¼Œå¯¹è½¬æ¢çš„unicodeè¿›è¡Œäº†ç®€é™‹çš„å¤„ç†ï¼ŒåŠ ä¸Šé¦–å°¾ç‰¹æ®Šç¬¦å· ï¼Œå¦‚[1f601]ã€‚
å½“ç„¶è¿™æ ·æ˜¯æ¯”è¾ƒç²—æš´çš„ï¼Œå¦‚æœæ­£å¸¸çš„å­—ç¬¦ä¸­ä¹Ÿæœ‰è¿™ç§å†…å®¹ï¼Œå°±è¢«å¼ºè½¬æˆäº†emojiè¡¨æƒ…ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ç†è§£ä¸ºå½©è›‹å•¦ï¼ˆè¯´ç™½äº†å°±æ˜¯ä¸šåŠ¡çš„è¦æ±‚æ¯”è¾ƒä½ï¼Œå¤„ç†çš„æ–¹å¼å¾ˆç®€é™‹ï¼‰ã€‚</p>

<p>å†æ¥çœ‹ä¸€ä¸‹è¿™ç§å¤„ç†æ–¹å¼çš„ä»£ä»·ï¼ŒåŸæœ¬ä¸€ä¸ª4å­—èŠ‚çš„emojiï¼Œç°åœ¨å˜æˆäº† [1f601]ï¼Œå‡è®¾è¿™é‡Œçš„å­—ç¬¦éƒ½æ˜¯1å­—èŠ‚çš„utf8ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦7ä¸ªå­—èŠ‚ï¼Œå¯¹å­˜å‚¨æ˜¯æœ‰ä¸€äº›æµªè´¹</p>

<p>é‚£ä¹ˆåœ¨javaä¸­è¦æ€ä¹ˆå¤„ç†å‘¢</p>

<p>é¦–å…ˆéœ€è¦è¯†åˆ«ï¼Œæ–‡æœ¬æ¥æºæ˜¯å¦åŒ…å«4å­—èŠ‚ï¼ˆåªå¤„ç†äº†4å­—èŠ‚ï¼Œ4å­—èŠ‚ä»¥ä¸Šä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼æ€è·¯ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›¿æ¢</p>

<pre><code class="language-java">    //æ˜¯å¦åŒ…å«4å­—èŠ‚ä»¥ä¸Šå­—ç¬¦
    public static boolean contains4BytesAbove(String src) {
        if(src == null) return false;
        try {
            byte[] bytes = src.getBytes(&quot;utf-8&quot;);
            for (int i = 0; i &lt; bytes.length; i++) {
                byte b = bytes[i];
                if (b &lt; 0 &amp;&amp; b &gt; -17) {
                    return true;
                }
            }
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return false;
    }

    //byteæ“ä½œæœ‰ç‚¹ç²—ç³™
    public static String marshallUnicode(String src) {
        try {
            List&lt;Byte&gt; bytes = Bytes.asList(src.getBytes(&quot;utf-8&quot;));

            List&lt;Integer&gt; indexList = new ArrayList&lt;&gt;();
            List&lt;String&gt; unicodeList = new ArrayList&lt;&gt;();
            for (int i = 0; i &lt; bytes.size(); i++) {
                byte b = bytes.get(i);
                String str = null;
                //ç›®å‰åªå¤„ç†äº†4å­—èŠ‚,è¶…è¿‡4å­—èŠ‚æ²¡æœ‰éªŒè¯
                if ((b &amp; 0xF0) == 0xF0) {
                    indexList.add(i);
                    byte[] unicodeBytes = new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3)};
                    str = new String(unicodeBytes, &quot;utf-8&quot;);
                    i += 3;
                    indexList.add(i);
                } else if ((b &amp; 0xF8) == 0xF8) {
                    indexList.add(i);
    //                str = new String(new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3), bytes.get(i + 4)}, &quot;utf-8&quot;);
                    str = &quot;?&quot;;
                    i += 4;
                    indexList.add(i);
                } else if ((b &amp; 0xFC) == 0xFC) {
                    indexList.add(i);
    //                str = new String(new byte[]{bytes.get(i), bytes.get(i + 1), bytes.get(i + 2), bytes.get(i + 3), bytes.get(i + 4), bytes.get(i + 5)}, &quot;utf-8&quot;);
                    str = &quot;?&quot;;
                    i += 5;
                    indexList.add(i);
                }
                if (str != null) {
                    String unicode = string2Unicode(str);
                    unicodeList.add(&quot;[&quot; + unicode + &quot;]&quot;);
                }
            }

            int begin = 0;
            List&lt;Byte&gt; resultBytes = Lists.newArrayList();
            for (int i = 0; i &lt; unicodeList.size(); i++) {
                int start = indexList.get(2 * i), end = indexList.get(2 * i + 1);
                resultBytes.addAll(bytes.subList(begin, start));
                byte[] unicode = unicodeList.get(i).getBytes();
                resultBytes.addAll(Bytes.asList(unicode));
                begin = end + 1;
            }
            resultBytes.addAll(bytes.subList(begin, bytes.size()));

            byte[] result = Bytes.toArray(resultBytes);
            return new String(result, &quot;utf-8&quot;);
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return src;
    }


    //è½¬æ¢
    public static String string2Unicode(String string) {
        StringBuffer unicode = new StringBuffer();
        int length = string.length();
        int tgt = 0;
        for (int i = 0; i &lt; length; i++) {
            // å–å‡ºæ¯ä¸€ä¸ªå­—ç¬¦
            char c = string.charAt(i);
            // è½¬æ¢ä¸ºunicode
            if (c &lt; 56320 &amp;&amp; 55295 &lt; c &amp;&amp; (i + 1) &lt; length) {
                char d = string.charAt(i + 1);
                if (d &lt; 57344 &amp;&amp; 56319 &lt; d) {
                    tgt = ((c - 55296) * 1024) + (d - 56320) + 65536;
                    i++;
                }
            }
        }
        return Integer.toHexString(tgt);
    }
</code></pre>

<p>åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šç»“æŸäº†ï¼Œå¤„ç†å®Œè¿™ä¸ªå¯¹å­—ç¬¦ç¼–ç åˆæœ‰äº†æ›´æ·±çš„è®¤è¯†</p>

<ul>
<li>å‚è€ƒï¼š</li>
<li><a href="http://cenalulu.github.io/linux/character-encoding/">http://cenalulu.github.io/linux/character-encoding/</a></li>
</ul>

			</div>

			
		</div>

  </body>
</html>
